{% include 'includes/header.html' %}

<div class="container mt-5">
    <!-- Eğer mesajlar varsa, uyarı olarak göster -->
    {% if messages %}
    <div class="alert alert-info">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <h2>Personel Listesi</h2>
    <table id="personnelTable" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>ID</th> <!-- Personel ID kolonu -->
                <th>İsim</th> <!-- Personel ismi kolonu -->
                <th>Takım</th> <!-- Personelin takımı kolonu -->
                <th>İşlemler</th>  <!-- Düzenleme ve silme işlemleri için butonlar -->
            </tr>
        </thead>
        <tbody>
            <!-- DataTable sunucu tarafından doldurulacak -->
        </tbody>
    </table>
</div>

{% include 'includes/footer.html' %}

<!-- jQuery ve DataTables kütüphanelerini ekliyoruz -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>

<!-- DataTable yapılandırması ve başlatılması -->
<script>
    $(document).ready(function() {
        $('#personnelTable').DataTable({
            "processing": true,  // Sunucuda işleme aktif
            "serverSide": true,  // Sunucu tarafında veri işleme yapılacak
            "ajax": {
                "url": "{% url 'personnel_data' %}",  // Veri almak için API URL'si
                "type": "GET"  // GET isteği ile veri alınacak
            },
            "columns": [
                { "data": "id" },  // Personel ID'si
                { "data": "name" },  // Personelin ismi
                { "data": "team__name" },  // Personelin takımı
                {
                    "data": "id",  // İşlem butonları oluşturma
                    "render": function (data, type, row, meta) {
                        var updateUrl = '{% url "personnel_update" 0 %}'.replace('0', data);  // Düzenleme URL'si
                        var deleteUrl = '{% url "personnel_delete" 0 %}'.replace('0', data);  // Silme URL'si
                        return '<a href="' + updateUrl + '" class="btn btn-warning btn-sm">Düzenle</a>' +
                               '<a href="' + deleteUrl + '" class="btn btn-danger btn-sm ml-2">Sil</a>';  // Düzenle ve sil butonları
                    }
                }
            ]
        });
    });
</script>
