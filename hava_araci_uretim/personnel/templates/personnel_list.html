{% include 'includes/header.html' %}

<div class="container mt-5">
    {% if messages %}
    <div class="alert alert-info">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
{% endif %}

    <h2>Personel Listesi</h2>
    <a href="{% url 'personnel_create' %}" class="btn btn-primary mb-3">Yeni Personel Ekle</a>  <!-- Yeni personel ekleme butonu -->
    <table id="personnelTable" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>ID</th>
                <th>İsim</th>
                <th>Takım</th>
                <th>İşlemler</th>  <!-- İşlem kolonunu ekledik -->
            </tr>
        </thead>
        <tbody>
            <!-- DataTable sunucu tarafından dolacak -->
        </tbody>
    </table>
</div>

{% include 'includes/footer.html' %}

<!-- jQuery ve DataTables JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>

<!-- DataTable'ı başlatıyoruz -->
<script>
    $(document).ready(function() {
        $('#personnelTable').DataTable({
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": "{% url 'personnel_data' %}",
                "type": "GET"
            },
            "columns": [
                { "data": "id" },
                { "data": "name" },
                { "data": "team__name" },
                {
                    "data": "id",
                    "render": function (data, type, row, meta) {
                        var updateUrl = '{% url "personnel_update" 0 %}'.replace('0', data);
                        var deleteUrl = '{% url "personnel_delete" 0 %}'.replace('0', data);
                        return '<a href="' + updateUrl + '" class="btn btn-warning btn-sm">Düzenle</a>' +
                               '<a href="' + deleteUrl + '" class="btn btn-danger btn-sm ml-2">Sil</a>';
                    }
                }
            ]
        });
    });
</script>
